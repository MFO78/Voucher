
<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Family Vouchers - International Edition</title>
    
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- JsBarcode -->
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.0/dist/JsBarcode.all.min.js"></script>

    <!-- html2canvas -->
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'], mono: ['Roboto Mono', 'monospace'] },
                    animation: { 'bounce-short': 'bounce 0.5s infinite', 'fade-in': 'fadeIn 0.3s ease-out' },
                    keyframes: { fadeIn: { '0%': { opacity: '0' }, '100%': { opacity: '1' } } }
                }
            }
        }
    </script>

    <style>
        body { -webkit-tap-highlight-color: transparent; font-family: 'Inter', sans-serif; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .preserve-3d { transform-style: preserve-3d; }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 antialiased overflow-x-hidden transition-colors duration-300">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- TRANSLATIONS & UI TEXT ---
        const uiText = {
            it: {
                title: "Vouchers",
                subtitle: "Family",
                back: "Indietro",
                homeTitle: "Chi vuoi viziare oggi?",
                voucherCount: "Buono",
                validity: "Validit√†: ‚àû",
                redeemed: "USATO",
                restore: "‚Ü∫ Ripristina",
                use: "‚úÖ Usa Ora",
                random: "üé≤ Pesca Random",
                share: "üì§ Condividi",
                loading: "Sto preparando il regalo...",
                saved: "Immagine salvata! Inviala manualmente.",
                error: "Errore nella creazione dell'immagine."
            },
            en: {
                title: "Vouchers",
                subtitle: "Family",
                back: "Back",
                homeTitle: "Who to spoil today?",
                voucherCount: "Voucher",
                validity: "Validity: ‚àû",
                redeemed: "USED",
                restore: "‚Ü∫ Restore",
                use: "‚úÖ Use Now",
                random: "üé≤ Random Pick",
                share: "üì§ Share",
                loading: "Wrapping your gift...",
                saved: "Image saved! Send it manually.",
                error: "Error creating image."
            }
        };

        // --- DATABASE VOUCHER (IT & EN) ---
        const voucherDB = {
            mamma: {
                color: "bg-pink-500", lightColor: "bg-pink-50", darkColor: "bg-pink-900/40", textColor: "text-pink-600",
                icon: "üëë", 
                content: {
                    it: {
                        title: "Mamma", desc: "Dittatrice Benevola",
                        finePrint: ["Termini: La ragione √® mia di default.", "Nota: Non abusare della mia pazienza.", "Valore: Inestimabile.", "Richiede un 'Grazie' sentito.", "Scade se alzi la voce."],
                        items: ["Abbraccio rigenerante", "Niente lamentele per 1 ora", "Riordino camera", "Colazione a letto", "Scegli tu il film", "Aiuto cucina", "Giornata 'Hai Ragione Tu'", "Ascolto attivo", "Complimento sincero", "Tregua conflitti", "Servizio taxi", "Caff√® preparato con amore", "Dichiarazione d'affetto", "Compiti senza drammi", "Massaggio relax spalle", "Uscita gelato (offro io)", "Annaffio le piante", "Niente 'cosa si mangia'", "Letto rifatto", "Ritiro panni stesi", "Ti insegno quella App", "Shopping insieme", "Svuoto lavastoviglie", "Un bacio a sorpresa", "Spa Casalinga"]
                    },
                    en: {
                        title: "Mom", desc: "Benevolent Dictator",
                        finePrint: ["Terms: I am right by default.", "Note: Don't push your luck.", "Value: Priceless.", "Requires a sincere 'Thank You'.", "Expires if you raise your voice."],
                        items: ["Recharging Hug", "No complaints for 1h", "Room cleanup", "Breakfast in bed", "You pick the movie", "Kitchen helper", "Day 'You Are Right'", "Active listening", "Sincere compliment", "Sibling truce", "Taxi service", "Coffee made with love", "Public affection", "Homework without drama", "Shoulder massage", "Ice cream date (on me)", "Watering plants", "No 'What's for dinner?'", "Bed made properly", "Laundry duty", "Tech support for App", "Shopping together", "Empty dishwasher", "Surprise kiss", "Home Spa Day"]
                    }
                }
            },
            papa: {
                color: "bg-blue-600", lightColor: "bg-blue-50", darkColor: "bg-blue-900/40", textColor: "text-blue-600",
                icon: "üëî", 
                content: {
                    it: {
                        title: "Pap√†", desc: "Il Boss (ma decide Mamma)",
                        finePrint: ["Batterie non incluse.", "Il telecomando torna al proprietario a fine uso.", "Non valido durante il pisolino.", "Richiede approvazione Mamma.", "Include battuta squallida."],
                        items: ["Bibita fresca sul divano", "Dominio telecomando", "Nessuna richiesta soldi (24h)", "Lavaggio auto", "Documentario noioso", "Silenzio durante pisolino", "Segreto custodito", "Lezione di vita (ascolto)", "Abbraccio virile", "Facchino per la spesa", "Rispetto per attrezzi", "Vittoria a carte", "Risata alla tua battuta", "Lotta sul tappeto", "Snack notturno", "Jolly 'Pap√† ha ragione'", "Assistente torcia", "Giro in bici", "Detox digitale", "Disegno ritratto", "Niente capricci", "Ricerca occhiali", "Ultimo biscotto", "Selfie buffo", "Attestato di forza"]
                    },
                    en: {
                        title: "Dad", desc: "The Boss (Mom decides)",
                        finePrint: ["Batteries not included.", "Remote returns to owner after use.", "Void during sacred nap.", "Requires Mom's approval.", "Includes Dad Joke."],
                        items: ["Cold drink on sofa", "Remote domination", "No money requests (24h)", "Car wash", "Boring documentary", "Silence during nap", "Secret kept", "Life lecture (I listen)", "Manly hug", "Grocery porter", "Respect for tools", "Card game victory", "Laugh at your joke", "Wrestling match", "Midnight snack", "Joker 'Dad is Right'", "Flashlight assistant", "Bike ride", "Digital Detox", "Portrait drawing", "No tantrums", "Finding your glasses", "Last cookie", "Funny selfie", "Strength certificate"]
                    }
                }
            },
            zia: {
                color: "bg-fuchsia-500", lightColor: "bg-fuchsia-50", darkColor: "bg-fuchsia-900/40", textColor: "text-fuchsia-600",
                icon: "üëú", 
                content: {
                    it: {
                        title: "Zia", desc: "La 'Mamma Cool'",
                        finePrint: ["D√¨ a mamma che sono bravo.", "Valido solo se mi vizi.", "Niente domande sulla scuola.", "Scadenza: Prossimo pranzo.", "Gossip in omaggio."],
                        items: ["Spiegazione Instagram Stories", "Porto borse shopping", "Ascolto gossip parenti", "Niente 'quando ti sposi?'", "Massaggio al collo", "Caff√® pronto", "Ti difendo da mamma", "Giornata Nipote Modello", "Aiuto outfit online", "Guardo reality trash", "Niente richieste soldi", "Foto profilo per te", "Compagnia Ikea", "Risposta immediata chat", "Lezione filtri foto", "Complimento sincero", "Nessuna lamentela regalo", "Offro colazione", "Compagnia in cucina", "Scarico tua musica", "Segreto condiviso", "Abbraccio spontaneo", "Posto sul divano", "Grattini", "Vengo a trovarti"]
                    },
                    en: {
                        title: "Aunt", desc: "The 'Cool Mom'",
                        finePrint: ["Tell mom I'm a good kid.", "Valid only if you spoil me.", "No questions about grades.", "Expires: Next family lunch.", "Free gossip included."],
                        items: ["Instagram Stories Lesson", "I carry shopping bags", "Listening to family gossip", "No 'When u getting married?'", "Neck massage", "Coffee ready", "Defense vs Mom", "Model Nephew Day", "Online outfit help", "Trash TV marathon", "No money requests", "Profile pic photoshoot", "Ikea companion", "Instant chat reply", "Photo filter lesson", "Sincere compliment", "No gift complaints", "Breakfast on me", "Kitchen company", "Music download help", "Shared secret", "Spontaneous hug", "Sofa seat priority", "Back scratches", "Visiting you willingly"]
                    }
                }
            },
            nonni: {
                color: "bg-emerald-600", lightColor: "bg-emerald-50", darkColor: "bg-emerald-900/40", textColor: "text-emerald-700",
                icon: "üß∂", 
                content: {
                    it: {
                        title: "Nonni", desc: "Sponsor Ufficiale Cibo",
                        finePrint: ["Rifiutare il cibo √® reato.", "Storia lunga min. 20 minuti.", "Non accetto 'No'.", "Devi dire che sono sciupato.", "Caramella inclusa."],
                        items: ["Lezione Smartphone", "Ascolto storia 'una volta...'", "Mangio tutto (anche bis)", "Partita a carte onesta", "Porto borse pesanti", "Sintonizzo canali TV", "Abbraccio spacca-ossa", "Lavoro nell'orto", "Leggo il giornale", "Pomeriggio no-telefono", "Caccia agli occhiali", "Film in bianco e nero", "Spiegazione 'Cloud'", "Autista per visite", "Niente 'non ho fame'", "Rispondo al fisso", "Guardo foto parenti", "Misuro la pressione", "Infilo l'ago", "Caff√® corretto (shh)", "Gelato insieme", "Ascolto senza guardare l'ora", "Lezione videochiamata", "Ti voglio bene (urlando)", "Ascolto consigli"]
                    },
                    en: {
                        title: "Grandparents", desc: "Official Food Sponsors",
                        finePrint: ["Refusing food is a crime.", "Story min length: 20 mins.", "I won't take 'No'.", "Must say I look thin.", "Candy included."],
                        items: ["Smartphone Lesson", "Listening to 'Back in my day'", "I eat everything (seconds too)", "Honest card game", "Carrying heavy bags", "Tuning TV channels", "Bone-crushing hug", "Garden work", "Reading newspaper", "No-phone afternoon", "Glasses hunt", "Black & white movie", "Explaining 'The Cloud'", "Driver for visits", "No 'I'm not hungry'", "Answering landline", "Viewing relatives' photos", "Checking blood pressure", "Threading the needle", "Spiked coffee (shh)", "Ice cream date", "Listening intently", "Video call lesson", "I love you (shouting)", "Unsolicited advice"]
                    }
                }
            },
            moglie: {
                color: "bg-rose-500", lightColor: "bg-rose-50", darkColor: "bg-rose-900/40", textColor: "text-rose-600",
                icon: "üíç", 
                content: {
                    it: {
                        title: "Moglie", desc: "Ha Sempre Ragione Lei",
                        finePrint: ["Clausola: Ho ragione io.", "Valido fino al cambio umore.", "Non esclude la spazzatura.", "Riscatto con bacio.", "Soddisfatti o divano."],
                        items: ["Jolly: Hai Ragione Tu", "Massaggio piedi", "Cena cucinata da me", "Film romantico", "Uscita libera amiche", "Colazione a letto", "Controllo TV", "Bagno caldo sola", "Sherpa per shopping", "Complimenti orari", "Gestisco io i figli", "Weekend no suocera", "Tisana sul divano", "Ascolto sfoghi", "Niente 'dov'√® la roba?'", "Dittatura telecomando", "Stiro la mia camicia", "Cucina pulita", "Dormita extra", "Scegli ristorante", "Bacio appassionato", "Ultima fetta torta", "Butto la spazzatura", "Serata No-Tech", "Abbraccio infinito"]
                    },
                    en: {
                        title: "Wife", desc: "She is Always Right",
                        finePrint: ["Clause: I am right.", "Valid until mood swing.", "Trash duty still applies.", "Redeem with a kiss.", "Satisfaction or sofa."],
                        items: ["Joker: You Are Right", "Foot massage", "Dinner cooked by me", "Romantic movie", "Girls' night out", "Breakfast in bed", "TV Control", "Hot bath alone", "Shopping Sherpa", "Hourly compliments", "I handle the kids", "No mother-in-law weekend", "Tea on sofa", "Venting session listener", "No 'Where is my stuff?'", "Remote dictatorship", "I iron my shirt", "Clean kitchen", "Extra sleep", "You pick restaurant", "Passionate kiss", "Last cake slice", "Taking out trash", "No-Tech evening", "Infinite hug"]
                    }
                }
            },
            marito: {
                color: "bg-slate-600", lightColor: "bg-slate-100", darkColor: "bg-slate-800/40", textColor: "text-slate-700",
                icon: "üç∫", 
                content: {
                    it: {
                        title: "Marito", desc: "Eroe del Divano",
                        finePrint: ["Valido se hai fatto lavoretti.", "Non esenta dai suoceri.", "Birra inclusa.", "Niente 'Dobbiamo parlare'.", "Uso limitato."],
                        items: ["Serata Libera", "Jolly: Hai Ragione Tu", "Trono telecomando", "Niente 'Dobbiamo parlare'", "Tuo piatto preferito", "Massaggio schiena", "Birra gelata servita", "Esenzione lavoretti", "Dormita fino a tardi", "Film d'azione", "Immunit√† idraulico", "Vittoria a Risiko", "Colazione da Re", "Complimento muscoli", "Esenzione spazzatura", "Accompagnatore Brico", "Ascolto hobby noioso", "Uscita amici", "DJ in auto", "Pizza e Film Violento", "Esenzione parenti", "Caff√® sveglia", "1 ora silenzio", "Restiamo a casa", "Bacio da film"]
                    },
                    en: {
                        title: "Husband", desc: "Sofa Hero",
                        finePrint: ["Valid if chores done.", "In-laws still apply.", "Beer included.", "No 'We need to talk'.", "Limited use."],
                        items: ["Free Night Out", "Joker: You Are Right", "Remote Throne", "No 'We need to talk'", "Favorite meal", "Back massage", "Cold beer served", "Chore exemption", "Sleep in late", "Action movie", "Plumber immunity", "Board game victory", "King's Breakfast", "Muscle compliment", "Trash duty exemption", "Hardware store buddy", "Boring hobby listener", "Boys' night out", "Car DJ", "Pizza & Action Movie", "In-laws exemption", "Wake-up coffee", "1h Silence", "Staying home", "Movie kiss"]
                    }
                }
            },
            sorella: {
                color: "bg-purple-500", lightColor: "bg-purple-50", darkColor: "bg-purple-900/40", textColor: "text-purple-600",
                icon: "üòà", 
                content: {
                    it: {
                        title: "Sorella", desc: "Nemica-Amica",
                        finePrint: ["Non valido se hai rubato roba.", "Se lo dici a mamma nego.", "Valida salvo litigio.", "Segreto di stato.", "No insulti cumulabili."],
                        items: ["Esco dalla camera", "Non tocco i trucchi", "Bagno libero", "Ti copro con mamma", "Ti presto la felpa", "Ascolto drammi", "Aiuto compiti", "Maratona serie TV", "Autista", "Tregua prese in giro", "Porto il t√®", "Bodyguard", "Fotografo Instagram", "Karaoke", "Ultimo dolce tuo", "Non leggo il diario", "Aiuto pulizia", "Video TikTok", "Presto penne", "Dico che sei brava", "Telecomando tuo", "Passaggio auto", "Regalo sticker", "Film in camera mia", "Ti voglio bene"]
                    },
                    en: {
                        title: "Sister", desc: "Frenemy",
                        finePrint: ["Void if you stole my stuff.", "If you tell mom I deny it.", "Valid until next fight.", "Top Secret.", "No insults allowed."],
                        items: ["Leaving your room", "Not touching makeup", "Free bathroom", "Covering for you", "Lending hoodie", "Listening to drama", "Homework help", "TV Marathon", "Chauffeur", "Teasing truce", "Bringing tea", "Bodyguard", "Instagram photographer", "Karaoke", "Last dessert is yours", "Not reading diary", "Cleaning help", "TikTok video", "Lending pens", "Praising you to mom", "Remote is yours", "Car ride", "Sticker gift", "Movie night my room", "I love you"]
                    }
                }
            },
            fratello: {
                color: "bg-indigo-500", lightColor: "bg-indigo-50", darkColor: "bg-indigo-900/40", textColor: "text-indigo-600",
                icon: "üëΩ", 
                content: {
                    it: {
                        title: "Fratello", desc: "L'Erede (di riserva)",
                        finePrint: ["Se mi batti spengo tutto.", "Non dire parolacce a mamma.", "Alleanza anti-genitori.", "Valido se porti l'acqua.", "Scade se mi annoio."],
                        items: ["Presto videogioco", "Non faccio la spia", "Esco dalla tana", "Ultima pizza tua", "Vinci al gioco", "Non ti copio", "Prestito soldi", "Supero livello", "Colpa mia", "Non tocco roba", "Spalla online", "Smetto fastidio", "Faccio panino", "Caricabatterie", "Niente disegni in faccia", "Difesa dai mostri", "Scegli gioco", "Usa il tablet", "Niente prese in giro", "Alleanza segreta", "Trovo oggetti persi", "Insegno trucco", "Dimentico imbarazzo", "Tregua armata", "Regalo doppione"]
                    },
                    en: {
                        title: "Brother", desc: "The Heir (Spare)",
                        finePrint: ["If you beat me I quit.", "Don't tell mom I swore.", "Anti-parent alliance.", "Valid if you bring water.", "Expires if bored."],
                        items: ["Lending game", "No snitching", "Leaving your lair", "Last pizza slice", "You win the game", "Not copying style", "Money loan", "Beating level", "My fault", "Not touching stuff", "Online wingman", "Stop annoying", "Making sandwich", "Charger loan", "No face drawing", "Monster defense", "You pick game", "Use tablet", "No teasing", "Secret alliance", "Finding lost items", "Teaching trick", "Forgetting embarrassment", "Armed truce", "Duplicate gift"]
                    }
                }
            },
            figlio: {
                color: "bg-orange-500", lightColor: "bg-orange-50", darkColor: "bg-orange-900/40", textColor: "text-orange-600",
                icon: "üå™Ô∏è", 
                content: {
                    it: {
                        title: "Figlio", desc: "Il Campione",
                        finePrint: ["Compiti vanno fatti.", "Lavati i denti.", "Non vale per saltare scuola.", "Scadenza: Primo capriccio.", "Abbraccio incluso."],
                        items: ["1 ora extra videogiochi", "Nanna dopo", "Cena no verdure", "Scegli menu", "Salti lavoretto", "Cinema", "Gelato gigante", "Tempo insieme", "Pancakes", "Tablet illimitato", "Pacchetto figurine", "Forte cuscini", "Battaglia Nerf", "Aiuto livello", "Uscita parco", "Campeggio salotto", "DJ auto", "Storia extra", "Hamburger", "Camera disordinata", "Giro esplorativo", "Lezione cose grandi", "Cartone loop", "Sorpresa", "Abbraccio gruppo"]
                    },
                    en: {
                        title: "Son", desc: "The Champion",
                        finePrint: ["Homework must be done.", "Brush your teeth.", "Can't skip school.", "Expires: First tantrum.", "Hug included."],
                        items: ["1h Extra Gaming", "Late bedtime", "No-veggie dinner", "You pick menu", "Skip chore", "Movies", "Giant ice cream", "Time together", "Pancakes", "Unlimited tablet", "Sticker pack", "Pillow fort", "Nerf battle", "Level help", "Park trip", "Living room camping", "Car DJ", "Extra story", "Hamburger", "Messy room ok", "Exploration trip", "Grown-up lesson", "Cartoon loop", "Surprise", "Group hug"]
                    }
                }
            },
            figlia: {
                color: "bg-cyan-500", lightColor: "bg-cyan-50", darkColor: "bg-cyan-900/40", textColor: "text-cyan-600",
                icon: "ü¶Ñ", 
                content: {
                    it: {
                        title: "Figlia", desc: "La Principessa",
                        finePrint: ["Brillantini non rimborsabili.", "Sorriso obbligatorio.", "Pap√† non pu√≤ dire no.", "Scadenza: Nanna.", "Coccole extra."],
                        items: ["Nanna dopo", "Dolce a scelta", "Pomeriggio creativo", "Niente riordino", "Film Disney", "Parrucchiere pap√†", "Uscita solo noi", "Gelato 3 gusti", "Biscotti insieme", "Cena a scelta", "Doppia storia", "Disco dance", "Niente lavoretti", "Pic-nic tappeto", "Progetto creativo", "Smalto unghie", "Tenda magica", "Gioco libero", "Imparo cose nuove", "Parco preferito", "Pigiama day", "Scegli gioco", "Regalino", "Disegniamo", "Abbraccio stritolante"]
                    },
                    en: {
                        title: "Daughter", desc: "The Princess",
                        finePrint: ["Glitter non-refundable.", "Smile required.", "Dad can't say no.", "Expires: Bedtime.", "Extra cuddles."],
                        items: ["Late bedtime", "Sweet of choice", "Creative afternoon", "No cleanup", "Disney movie", "Dad Hairdresser", "Just us trip", "3-flavor ice cream", "Baking cookies", "Dinner choice", "Double story", "Disco dance", "No chores", "Carpet picnic", "Creative project", "Nail polish", "Magic tent", "Free play", "Learning new things", "Favorite park", "Pajama day", "Pick the game", "Small gift", "Drawing together", "Crushing hug"]
                    }
                }
            }
        };

        // --- AUDIO & HAPTIC ---
        const playSound = (type) => {
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            if (!AudioContext) return;
            const ctx = new AudioContext();
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();
            osc.connect(gain); gain.connect(ctx.destination);
            const now = ctx.currentTime;
            if (type === 'click') {
                osc.type = 'sine'; osc.frequency.setValueAtTime(600, now); osc.frequency.exponentialRampToValueAtTime(100, now + 0.1);
                gain.gain.setValueAtTime(0.1, now); gain.gain.linearRampToValueAtTime(0, now + 0.1);
                osc.start(now); osc.stop(now + 0.1);
            } else if (type === 'shutter') {
                osc.type = 'square'; osc.frequency.setValueAtTime(800, now); 
                gain.gain.setValueAtTime(0.1, now); gain.gain.exponentialRampToValueAtTime(0.01, now + 0.08);
                osc.start(now); osc.stop(now + 0.08);
            }
        };
        const triggerHaptic = () => { if (navigator.vibrate) navigator.vibrate(10); };

        const App = () => {
            const [category, setCategory] = useState(null);
            const [index, setIndex] = useState(0);
            const [darkMode, setDarkMode] = useState(false);
            const [redeemed, setRedeemed] = useState(false);
            const [sharing, setSharing] = useState(false);
            const [lang, setLang] = useState('it'); // Language State
            const [barcodeId, setBarcodeId] = useState("000000");
            const barcodeRef = useRef(null);
            const cardRef = useRef(null);

            useEffect(() => {
                if (darkMode) document.documentElement.classList.add('dark');
                else document.documentElement.classList.remove('dark');
            }, [darkMode]);

            useEffect(() => {
                if (category && barcodeRef.current) {
                    const id = Math.floor(1000000 + Math.random() * 900000).toString();
                    setBarcodeId(id);
                    JsBarcode(barcodeRef.current, id, { format: "CODE128", lineColor: "#000", width: 1.5, height: 40, displayValue: false, background: "#fff" });
                }
            }, [index, category]);

            const handleShare = async () => {
                if (!cardRef.current) return;
                setSharing(true); playSound('shutter'); triggerHaptic();
                try {
                    await new Promise(r => setTimeout(r, 100));
                    const canvas = await html2canvas(cardRef.current, { scale: 2, backgroundColor: null, useCORS: true, logging: false });
                    canvas.toBlob(async (blob) => {
                        if (!blob) throw new Error("Blob creation failed");
                        const fileName = `voucher_${category}_${barcodeId}.png`;
                        const file = new File([blob], fileName, { type: 'image/png' });
                        if (navigator.canShare && navigator.canShare({ files: [file] })) {
                            try { await navigator.share({ files: [file], title: 'Voucher', text: 'Regalo! üéÅ' }); } catch (err) {}
                        } else {
                            const link = document.createElement('a'); link.href = URL.createObjectURL(blob); link.download = fileName;
                            document.body.appendChild(link); link.click(); document.body.removeChild(link);
                            alert(uiText[lang].saved);
                        }
                        setSharing(false);
                    }, 'image/png');
                } catch (error) { console.error(error); alert(uiText[lang].error); setSharing(false); }
            };

            const toggleRedeem = () => { setRedeemed(!redeemed); triggerHaptic(); };
            const nextCard = () => { setRedeemed(false); setIndex((prev) => (prev + 1) % voucherDB[category].content[lang].items.length); playSound('click'); };
            const prevCard = () => { setRedeemed(false); setIndex((prev) => (prev - 1 + voucherDB[category].content[lang].items.length) % voucherDB[category].content[lang].items.length); playSound('click'); };
            const randomCard = () => { setRedeemed(false); setIndex(Math.floor(Math.random() * voucherDB[category].content[lang].items.length)); playSound('click'); };
            
            const toggleLang = () => { setLang(prev => prev === 'it' ? 'en' : 'it'); playSound('click'); };

            const currentData = category ? voucherDB[category] : null;
            const currentContent = currentData ? currentData.content[lang] : null;

            return (
                <div className={`min-h-screen flex flex-col items-center justify-center transition-colors duration-300 ${darkMode ? 'bg-slate-950' : 'bg-gray-50'}`}>
                    <div className="fixed inset-0 overflow-hidden pointer-events-none">
                        <div className={`absolute -top-[20%] -left-[20%] w-[70%] h-[70%] rounded-full blur-[100px] opacity-30 ${darkMode ? 'bg-purple-900' : 'bg-pink-200'}`}></div>
                        <div className={`absolute -bottom-[20%] -right-[20%] w-[70%] h-[70%] rounded-full blur-[100px] opacity-30 ${darkMode ? 'bg-blue-900' : 'bg-blue-200'}`}></div>
                    </div>

                    {/* NAVBAR */}
                    <nav className={`w-full z-20 px-6 py-4 flex justify-between items-center sticky top-0 backdrop-blur-md border-b transition-colors ${darkMode ? 'bg-slate-900/80 border-slate-700' : 'bg-white/70 border-gray-200'}`}>
                        <div className="flex items-center gap-2 cursor-pointer" onClick={() => setCategory(null)}>
                            <span className="text-2xl">‚ú®</span>
                            <h1 className={`font-bold text-xl ${darkMode ? 'text-white' : 'text-gray-900'}`}>{uiText[lang].title}<span className="opacity-50 font-normal"> {uiText[lang].subtitle}</span></h1>
                        </div>
                        <div className="flex gap-2">
                            {/* LANG TOGGLE */}
                            <button onClick={toggleLang} className={`px-3 py-1 rounded-full text-xs font-bold border ${darkMode ? 'border-slate-600 text-white' : 'bg-white text-gray-800'}`}>
                                {lang.toUpperCase()}
                            </button>
                            <button onClick={() => setDarkMode(!darkMode)} className={`p-2 rounded-full ${darkMode ? 'bg-slate-800 text-yellow-400' : 'bg-gray-200 text-gray-600'}`}>
                                {darkMode ? '‚òÄÔ∏è' : 'üåô'}
                            </button>
                            {category && (<button onClick={() => setCategory(null)} className={`px-4 py-2 rounded-full text-sm font-bold border ${darkMode ? 'border-slate-600 text-white' : 'bg-white text-gray-800'}`}>{uiText[lang].back}</button>)}
                        </div>
                    </nav>

                    {sharing && (<div className="fixed inset-0 z-50 flex flex-col items-center justify-center bg-black/80 backdrop-blur-sm text-white animate-fade-in"><div className="text-4xl animate-bounce mb-4">üì∏</div><p className="font-bold">{uiText[lang].loading}</p></div>)}

                    <main className="flex-1 w-full max-w-4xl z-10 p-4 flex flex-col items-center justify-center">
                        {!category && (
                            <div className="w-full animate-fade-in">
                                <h2 className={`text-center text-3xl md:text-4xl font-black mb-8 ${darkMode ? 'text-white' : 'text-gray-900'}`}>{uiText[lang].homeTitle}</h2>
                                <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                                    {Object.entries(voucherDB).map(([key, data]) => (
                                        <button key={key} onClick={() => setCategory(key)} className={`relative overflow-hidden rounded-3xl p-6 text-left transition-transform hover:scale-105 shadow-sm border-2 border-transparent hover:border-black/5 ${darkMode ? data.darkColor : data.lightColor} ${darkMode ? 'hover:border-white/20' : ''}`}>
                                            <div className="text-4xl mb-4 drop-shadow-md">{data.icon}</div>
                                            <h3 className={`font-black uppercase ${darkMode ? 'text-white' : data.textColor}`}>{data.content[lang].title}</h3>
                                            <p className={`text-xs font-bold opacity-70 ${darkMode ? 'text-white/70' : data.textColor}`}>{data.content[lang].desc}</p>
                                        </button>
                                    ))}
                                </div>
                            </div>
                        )}

                        {category && currentContent && (
                            <div className="flex flex-col items-center w-full max-w-sm animate-fade-in">
                                <div className="relative w-full aspect-[3/5] perspective-1000 mb-6">
                                    <div ref={cardRef} className={`relative w-full h-full rounded-[32px] overflow-hidden flex flex-col shadow-2xl border-4 transition-all duration-300 transform ${darkMode ? 'bg-slate-800 border-slate-700' : 'bg-white border-white'} ${redeemed ? 'grayscale opacity-90' : ''}`}>
                                        <div className={`h-[35%] ${currentData.color} p-6 flex flex-col items-center justify-center text-white relative overflow-hidden`}>
                                            <div className="absolute top-[-50%] left-[-50%] w-full h-full bg-white/20 rounded-full blur-3xl"></div>
                                            <div className="text-5xl drop-shadow-lg z-10">{currentData.icon}</div>
                                            <h2 className="text-3xl font-black uppercase tracking-widest mt-2 z-10">{currentContent.title}</h2>
                                            <p className="z-10 text-xs font-bold uppercase opacity-80 mt-1 tracking-wider bg-black/10 px-3 py-1 rounded-full">{currentContent.desc}</p>
                                        </div>

                                        <div className={`flex-1 flex flex-col items-center justify-center p-6 text-center ${darkMode ? 'bg-slate-800' : 'bg-white'}`}>
                                            <div className={`absolute top-[33%] -left-3 w-6 h-6 rounded-full ${darkMode ? 'bg-slate-950' : 'bg-gray-50'}`}></div>
                                            <div className={`absolute top-[33%] -right-3 w-6 h-6 rounded-full ${darkMode ? 'bg-slate-950' : 'bg-gray-50'}`}></div>

                                            <div className="flex-1 flex flex-col items-center justify-center">
                                                <h3 className={`text-2xl md:text-3xl font-black leading-tight mb-4 ${darkMode ? 'text-white' : currentData.textColor}`}>"{currentContent.items[index]}"</h3>
                                                <p className={`text-xs md:text-sm font-medium italic opacity-70 px-4 ${darkMode ? 'text-gray-300' : 'text-gray-500'}`}>{currentContent.finePrint[index % currentContent.finePrint.length]}</p>
                                            </div>

                                            <div className="mt-auto w-full bg-white p-3 rounded-xl flex flex-col items-center shadow-sm">
                                                <div className="flex justify-between w-full text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-1"><span>{uiText[lang].validity}</span><span>ID: {barcodeId.substring(0,4)}</span></div>
                                                <canvas ref={barcodeRef} className="h-10 w-full"></canvas>
                                            </div>

                                            {redeemed && (<div className="absolute inset-0 flex items-center justify-center bg-white/40 backdrop-blur-[2px] z-20"><div className="border-[6px] border-red-600 text-red-600 font-black text-4xl px-4 py-2 transform -rotate-12 bg-white rounded-xl shadow-2xl">{uiText[lang].redeemed}</div></div>)}
                                        </div>
                                    </div>
                                </div>

                                <div className="w-full space-y-3">
                                    <div className="flex gap-3">
                                        <button onClick={prevCard} className={`p-4 rounded-2xl shadow-sm border ${darkMode ? 'bg-slate-800 border-slate-700 text-white' : 'bg-white border-gray-100'}`}>‚¨ÖÔ∏è</button>
                                        <button onClick={toggleRedeem} className={`flex-1 rounded-2xl font-bold text-lg shadow-lg ${darkMode ? 'bg-white text-black' : 'bg-black text-white'}`}>{redeemed ? uiText[lang].restore : uiText[lang].use}</button>
                                        <button onClick={nextCard} className={`p-4 rounded-2xl shadow-sm border ${darkMode ? 'bg-slate-800 border-slate-700 text-white' : 'bg-white border-gray-100'}`}>‚û°Ô∏è</button>
                                    </div>
                                    <div className="grid grid-cols-2 gap-3">
                                        <button onClick={randomCard} className={`p-3 rounded-2xl font-bold text-sm border shadow-sm ${darkMode ? 'bg-slate-800 border-slate-700 text-purple-400' : 'bg-white border-gray-100 text-purple-600'}`}>{uiText[lang].random}</button>
                                        <button onClick={handleShare} className={`p-3 rounded-2xl font-bold text-sm border shadow-sm ${darkMode ? 'bg-slate-800 border-slate-700 text-blue-400' : 'bg-white border-gray-100 text-blue-600'}`}>{uiText[lang].share}</button>
                                    </div>
                                </div>
                            </div>
                        )}
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>

